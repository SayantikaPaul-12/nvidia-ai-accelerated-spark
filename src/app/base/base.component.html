<header class="header">
  <h1 class="title">Hello, there</h1>
  <p class="subtitle">Choose your 80++ AI assistant:</p>
  <ul class="agent-suggestion-list">
    <li class="agent-suggestion" *ngFor="let agent of agentTypes" [class.active]="selectedAgent === agent.value"
      (click)="selectAgent(agent.value)">

      <label class="agent-radio">
        <input type="radio" name="agent" [value]="agent.value" [checked]="selectedAgent === agent.value" readonly />
        <span class="radio-circle"></span>
      </label>

      <div class="agent-info">
        <h4 class="agent-label">{{ agent.label }}</h4>
        <p class="agent-description">{{ agent.description }}</p>
      </div>

      <span class="icon material-symbols-rounded">person</span>
    </li>
  </ul>
</header>

<!-- Agent Type Selector Box - Top Right -->
<div class="agent-selector-box">
  <h4>Select Agent</h4>
  <ul class="agent-options">
    <li
      *ngFor="let agent of agentTypes"
      [class.selected]="selectedAgent === agent.value"
      (click)="selectAgent(agent.value)"
      class="suggestion agent-option"
      [attr.title]="agent.description">
      <span class="icon material-symbols-rounded">person</span>
      <span class="text">{{ agent.label }}</span>
    </li>
  </ul>
</div>


<!-- Scrollable chat container -->
<div id="scroller">
  <div class="chat-list">
    <div *ngFor="let message of chatMessages" class="message" [ngClass]="message.type">
      <ng-container *ngIf="message.type === 'incoming'; else outgoingMessage">
        <div class="markdown-box message-content">
          <span class="avatar material-symbols-rounded">smart_toy</span>
          <div class="text markdown-render">
            <markdown [data]="message.text"></markdown>
          </div>
        </div>
      </ng-container>

      <ng-template #outgoingMessage>
        <div class="message-content">
          <span class="avatar material-symbols-rounded">person</span>
          <div class="text markdown-render">
            <p>{{ message.text }}</p>
          </div>
        </div>
      </ng-template>

      <span class="icon material-symbols-rounded" (click)="copyMessage(message.text)">content_copy</span>
    </div>




    <!-- Typing effect (in progress) -->
    <div *ngIf="displayedText" class="message incoming markdown-box">
      <div class="message-content">
        <span class="avatar material-symbols-rounded">smart_toy</span>
        <div class="text markdown-render">
          <markdown [data]="displayedText"></markdown>
          <span class="cursor-blink">|</span>
        </div>
      </div>
    </div>


    <!-- Blinking loader -->
    <div *ngIf="loading && !displayedText" class="message incoming">
      <div class="message-content">
        <span class="avatar material-symbols-rounded">smart_toy</span>
        <p class="text">
          <span class="dot-blink"></span>
          <span class="dot-blink" style="animation-delay: 0.2s;"></span>
          <span class="dot-blink" style="animation-delay: 0.4s;"></span>
        </p>
      </div>
    </div>
  </div>
  <div id="anchor"></div>
</div>



<div *ngIf="uploadedFiles.length > 0" class="uploaded-files-container"
  style="display:flex; overflow-x:auto; gap:12px; padding:8px 16px; max-width: 100%;">

  <div *ngFor="let file of uploadedFiles" class="uploaded-file-box" style="
      flex: 0 0 auto;
      display:flex;
      align-items:center;
      gap:8px;
      padding:6px 12px;
      border-radius: 8px;
      background-color: var(--surface-variant, #f0f0f0);
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      cursor: default;
      min-width: 160px;
    ">
    <span class="icon material-symbols-rounded" style="font-size: 20px; color: var(--primary, #6200ee);">
      attachment
    </span>
    <span class="file-name" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
      {{ file.name }}
    </span>
  </div>
</div>

<!-- Input Area -->
<div class="typing-area">
  <form class="typing-form" (submit)="handleSubmit($event)">
    <div class="input-wrapper">
      <input type="text" [(ngModel)]="userInput" name="message" placeholder="Enter a prompt here" class="typing-input"
        required />
      <button type="submit" id="send-message-button" class="icon material-symbols-rounded">send</button>
    </div>

    <!-- Document Upload Button -->
    <!-- <div class="file-upload-wrapper">
      <label for="file-upload" class="file-upload-label icon material-symbols-rounded" style="cursor:pointer;">
        upload_file
      </label>
      <input type="file" id="file-upload" (change)="handleFileUpload($event)" accept=".pdf,.doc,.docx,.txt"
        style="display:none" />
    </div> -->

    <div class="action-buttons">
      <span id="theme-toggle-button" class="icon material-symbols-rounded" (click)="toggleTheme()">
        {{ isLightMode ? 'dark_mode' : 'light_mode' }}
      </span>
      <span id="delete-chat-button" class="icon material-symbols-rounded" (click)="clearChat()">delete</span>
    </div>
  </form>
  <p class="disclaimer-text">
    Developed for the AI Spark Challenge - ASU and NVIDIA - 2025.
  </p>
</div>